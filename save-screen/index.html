<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>Canvas</title>
    <style>
        .container {
            position: relative;
        }
        canvas, .cropper {
            position: absolute;
            top: 0;
            left: 0;
        }
        .cropper {
            border: dashed 5px;
        }
    </style>
</head>

<body>
    <script>
        function fileToDataURL(file) {
            return new Promise((res, rej) => {
                let reader = new FileReader();
                reader.addEventListener("load", e => {
                    res(reader.result);
                });
                reader.addEventListener("error", e => {
                    rej(e);
                })
                reader.readAsDataURL(file);
            });
        }

        function dataURLToImage(dataURL) {
            return new Promise((res, rej) => {
                let image = new Image();
                image.addEventListener("load", e => {
                    res(e.target);
                });
                image.addEventListener("error", e => {
                    rej(e);
                })
                image.src = dataURL;
            });
        }

        document.addEventListener("DOMContentLoaded", () => {
            let body = document.body; 
            body.addEventListener("paste", async e => {
                let item = e.clipboardData.items[0];
                if (item.kind === "file" && item.type.startsWith("image/")) {
                    let canvas = document.createElement("canvas"),
                    container = document.createElement("div"),
                    cropper = document.createElement("div"),
                    context = canvas.getContext("2d"),
                    dataURL = await fileToDataURL(item.getAsFile()),
                    image = await dataURLToImage(dataURL);

                    container.classList.add("container");
                    cropper.classList.add("cropper");
                    [canvas.height, canvas.width] = [image.height, image.width];
                    [container.style.height, container.style.width] = [cropper.style.height, cropper.style.width] = [`${image.height}px`, `${image.width}px`];
                    cropper.draggable = true;
                    context.drawImage(image, 0, 0);
                    container.append(canvas, cropper);
                    body.insertBefore(container, body.firstChild);
                }
            });
        });
    </script>
</body>

</html>